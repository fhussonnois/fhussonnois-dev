<!doctype html><html lang=en-us data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Why is Managing Kafka Topics Still Such a Pain? Introducing Jikkou! | Florian Hussonnois - Random Thoughts about Software Engineering</title>
<meta name=description content="Florian Hussonnois - Blog about Apache Kafka, Data Streaming, Event-Driven Architecture, and Open Source Software Engineering"><meta name=author content="Florian Hussonnois"><meta property="og:title" content="Why is Managing Kafka Topics Still Such a Pain? Introducing Jikkou!"><meta property="og:description" content="Florian Hussonnois - Blog about Apache Kafka, Data Streaming, Event-Driven Architecture, and Open Source Software Engineering"><meta property="og:type" content="article"><meta property="og:url" content="https://www.fhussonnois.dev/posts/2023-05-16-why-is-managing-kafka-topics-still-such-a-pain-introducing-jikkou/"><meta property="og:image" content="https://www.fhussonnois.dev/images/posts/jikkou-cover.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Why is Managing Kafka Topics Still Such a Pain? Introducing Jikkou!"><meta name=twitter:description content="Florian Hussonnois - Blog about Apache Kafka, Data Streaming, Event-Driven Architecture, and Open Source Software Engineering"><meta name=twitter:image content="https://www.fhussonnois.dev/images/posts/jikkou-cover.jpg"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel=stylesheet><script>(function(){var e=localStorage.getItem("theme");e==="light"&&document.documentElement.setAttribute("data-theme","light")})()</script><link rel=stylesheet href=/css/main.min.3af5cc91638dd93bbff931bc8a085c7867e87071fb48b259c698e7786fb049b8.css><link rel=icon type=image/png href=/images/avatar.png></head><body><a class=skip-to-content href=#main-content>Skip to content</a><nav class=site-nav role=navigation aria-label="Main navigation"><div class=nav-inner><a class=nav-logo href=/><span class=prompt>>_</span> fhussonnois.dev</a><ul class=nav-links id=nav-links><li><a href=/posts/ aria-current=section>Blog</a></li><li><a href=/projects/>Projects</a></li><li><a href=/conferences/>Conferences</a></li><li><a href=/about/>About</a></li><li><a href=/tags/>Tags</a></li></ul><div class=nav-right><button class=theme-toggle aria-label="Toggle dark mode">
<span class=icon-sun><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span><span class=icon-moon><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span></button>
<button class=nav-toggle aria-label="Toggle menu" aria-expanded=false><svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></nav><main id=main-content><article class=container><header class=post-header><h1 class=post-title>Why is Managing Kafka Topics Still Such a Pain? Introducing Jikkou!</h1><div class=post-meta><time datetime=2023-05-16>May 16, 2023</time>
<span>3067 words</span>
<span>15 min read</span></div><div class=post-tags><a class=tag-pill href=/tags/apache-kafka/>apache kafka</a>
<a class=tag-pill href=/tags/low-code/>low code</a>
<a class=tag-pill href=/tags/data/>data</a>
<a class=tag-pill href=/tags/event-streaming/>event streaming</a>
<a class=tag-pill href=/tags/open-source/>open source</a></div></header><div class=prose><p><img src=/images/posts/jikkou-cover.jpg alt="Photo by Jon Cartagena on Unsplash" loading=lazy></p><p><em>Photo by <a href=https://unsplash.com/@joncartagena target=_blank rel="noopener noreferrer">Jon Cartagena</a>
on <a href=https://unsplash.com target=_blank rel="noopener noreferrer">Unsplash</a></em></p><h2 id=motivation><a class=heading-anchor href=#motivation>#</a>Motivation</h2><p>Since I started working with <a href=https://kafka.apache.org/ target=_blank rel="noopener noreferrer">Apache Kafka</a>
eight years ago, managing topics on a scalable platform has always been a headache for both developers and infrastructure teams. Of course, when a Kafka cluster is used and managed by a single team, creating and managing topics remains relatively simple. In such cases, using Kafka CLI <code>kafka-topics.sh</code> and <code>kafka-configs.sh</code> may be sufficient to meet daily operational needs.</p><p>However, as the use of our data streaming platform grows, configuring and managing Kafka topics becomes increasingly challenging. It&rsquo;s not uncommon to see Kafka clusters with hundreds of topics created and used by dozens of teams without any restrictions, leading to a true nightmare for infrastructure and data governance teams. And that&rsquo;s not even considering replica partition assignments and data rebalancing, which is a topic in itself.</p><p>For this reason, some teams start implementing topic naming conventions and configuration practices from the very beginning of their projects. This is seen as a first step towards establishing data governance on their streaming platforms, with the goal of maintaining control over the data streams.</p><p>But, what about the tools available for this? Based on my experience, I&rsquo;ve observed various methods, each with its own advantages. It&rsquo;s important to note that there are no inherently bad solutions, as teams tend to choose the tools they are most comfortable with and that best suit their context.</p><p>Here&rsquo;s a non-exhaustive list of solutions I&rsquo;ve encountered in different projects:</p><ul><li><strong>Kafka CLI</strong> <code>kafka-topics</code> and <code>kafka-configs</code> (or custom scripts)</li><li><strong>Custom tools</strong> (built on top of the Kafka Java Admin Client).</li><li><strong>Ansible</strong></li><li><strong>Strimzi</strong> (Topic Operator)</li><li><strong>Terraform Modules</strong></li><li><strong>JulieOps</strong> <em>(not anymore maintained)</em></li><li><strong>UIs</strong> like AKHQ, Conduktor, and others</li></ul><p>These tools can generally be categorized as infrastructure as code solutions or others that don&rsquo;t offer the same level of portability and capabilities. In addition, solutions like <a href=https://www.ansible.com/ target=_blank rel="noopener noreferrer">Ansible</a>
or <a href=https://www.terraform.io/ target=_blank rel="noopener noreferrer">Terraform</a>
are often preferred by DevOps teams and are not as commonly used by development teams. As for <a href=https://strimzi.io/ target=_blank rel="noopener noreferrer">Strimzi</a>
and its KafkaTopic Operator, not everyone is running on Kubernetes.</p><p>Considering these observations, I started developing an extensible simple tool called Jikkou, which is built on top of the Kafka Java Admin Client and designed to manage topics and other Kafka entities.</p><h2 id=introducing-jikkou-simplifying-kafka-topic-management><a class=heading-anchor href=#introducing-jikkou-simplifying-kafka-topic-management>#</a>Introducing Jikkou: Simplifying Kafka Topic Management</h2><p>In the previous section, we briefly discussed the challenges of managing Kafka topics at scale and explored various tools used on projects.
Now, let&rsquo;s delve into Jikkou, a tool that aims to simplify Kafka topic management and provide a streamlined solution for developers and infrastructure teams.</p><h3 id=understanding-jikkous-approach><a class=heading-anchor href=#understanding-jikkous-approach>#</a>Understanding Jikkou&rsquo;s Approach</h3><p><a href=https://github.com/streamthoughts/jikkou target=_blank rel="noopener noreferrer">Jikkou</a>
, which means &ldquo;<em>execution (e.g. of a plan) or actual state (of things)</em>&rdquo; in Japanese, is a lightweight open-source tool written in Java. It offers both a command-line interface (CLI) and a Java library, enabling you to reconcile your Apache Kafka cluster with a desired state.</p><blockquote><p>&ldquo;Jikkou adopts a stateless approach, and thus does not store any state internally. Instead, it leverages your system as the source of truth&rdquo;.</p></blockquote><p>Jikkou adopts a <strong>stateless</strong> approach and thus does not store any state internally. Instead, it leverages your system as the source of truth. In other words, <em>Your Apache Kafka Cluster is the state of Jikkou!</em> This design allows you to seamlessly integrate Jikkou with other solutions or use it on an ad hoc basis for specific needs, making it incredibly flexible and versatile (this makes it easy for you to try it).</p><p>In addition, Jikkou uses the concept of &ldquo;<strong>Resources</strong>&rdquo; to represent entities that reflect the state of specific aspects of your system, such as a <em>Topic</em> or an <em>ACL</em> on your Apache Kafka cluster. These resource definitions are described using standard <strong>YAML</strong> files, making them easy to create, version, share, and publish.</p><p>Moreover, Jikkou was designed to be extensible, enabling it to support additional types of resource entities beyond the scope of Apache Kafka. This extensibility ensures that Jikkou can adapt to evolving needs and accommodate a wide range of use cases.</p><h3 id=key-features-of-jikkou><a class=heading-anchor href=#key-features-of-jikkou>#</a>Key Features of Jikkou</h3><p>Let&rsquo;s explore some of the key features that Jikkou provides :</p><ol><li><p><strong>Topic Creation and Configuration:</strong> Jikkou allows you to easily create new topics, update their configurations and then delete them if needed. It also provides the capability to just export some topics configurations to eventually apply them on a different Kafka cluster.</p></li><li><p><strong>Client Quota Limits:</strong> Jikkou allows you to configure quotas limits for authenticated principals and clients.</p></li><li><p><strong>Authorization and Access Control List:</strong> Jikkou allows you to configure access control lists (ACLs) effortlessly, ensuring that only authorized users or applications can read from or write to specific topics.</p></li></ol><p>These are just a few highlights of Jikkou&rsquo;s features. As we delve deeper into the tool, you&rsquo;ll discover how it addresses common pain points in Kafka topic management and empowers your team to handle topics effectively.</p><h2 id=getting-started-with-jikkou><a class=heading-anchor href=#getting-started-with-jikkou>#</a>Getting Started with Jikkou</h2><p>To begin your journey with Jikkou, let&rsquo;s explore how you can effortlessly create and manage Kafka topics using some practical examples. For this purpose, we will use an Apache Kafka cluster managed service provided by Aiven</p><p>(<em>Disclaimer: To be transparent at the time of writing this article, I&rsquo;m using Aiven for an Apache Kafka cluster managed as part of a client project. Aiven also offers a free plan, which is ideal to run demos and experiments</em>).</p><h3 id=step-0-create-an-apache-kafka-cluster-in-5min><a class=heading-anchor href=#step-0-create-an-apache-kafka-cluster-in-5min>#</a>Step 0: Create an Apache Kafka Cluster in 5min</h3><p>To get started with a free trial of Apache Kafka, simply visit <a href=https://aiven.io/ target=_blank rel="noopener noreferrer">https://aiven.io/</a>
and create an account. Once you&rsquo;ve created your account, proceed to create a new project and set up a new Apache Kafka service. For the purpose of this demo, you can select the <strong>Startup-2</strong> service plan.</p><p>When creating your Apache Kafka service, you will be prompted to choose your authentication method. Choose <strong>Client certificate</strong>, and then, download the <strong>CA Certificate</strong>, <strong>Access Certificate</strong>, and <strong>Access Key</strong> to be able later to authenticate to the Apache Kafka cluster.</p><p>Finally, use the downloaded certificates to create the client Keystore and Truststore using the following commands:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6c7086;font-style:italic># Create Client Keystore</span>
</span></span><span style=display:flex><span>openssl pkcs12 -export -inkey service.key -in service.cert -out client.keystore.p12 -name service_key
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic># Import Client Truststore</span>
</span></span><span style=display:flex><span>keytool -import -file ca.pem -alias CA -keystore client.truststore.jks
</span></span></code></pre></div><p><em>Note: For detailed instructions on setting up an Apache Kafka service on Aiven, you can refer to the documentation at <a href=https://docs.aiven.io/docs/products/kafka/getting-started target=_blank rel="noopener noreferrer">https://docs.aiven.io/docs/products/kafka/getting-started</a>
.</em></p><h3 id=step-1-install-and-configure-jikkou-cli><a class=heading-anchor href=#step-1-install-and-configure-jikkou-cli>#</a>Step 1: Install and configure Jikkou CLI</h3><p>First, ensure that you have Java 17 or higher installed on your system. Jikkou requires Java to run.</p><p>Next, download and install the latest release of Jikkou. For Debian, run the following commands to install the latest version:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/streamthoughts/jikkou/releases/download/0.19.0/jikkou.deb
</span></span><span style=display:flex><span>sudo dpkg -i jikkou.deb <span style=color:#89dceb;font-weight:700>&amp;&amp;</span> <span style=color:#89b4fa>\
</span></span></span><span style=display:flex><span><span style=color:#89b4fa></span><span style=color:#89dceb>source</span> &lt;<span style=color:#89dceb;font-weight:700>(</span>jikkou generate-completion<span style=color:#89dceb;font-weight:700>)</span> <span style=color:#89dceb;font-weight:700>&amp;&amp;</span> <span style=color:#89b4fa>\
</span></span></span><span style=display:flex><span><span style=color:#89b4fa></span>jikkou --version
</span></span></code></pre></div><p>or just run:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s https://raw.githubusercontent.com/streamthoughts/jikkou/main/get.sh | sh
</span></span></code></pre></div><p><em>Note: You can follow the following instructions to install it from a tarball distribution (<a href=https://streamthoughts.github.io/jikkou/docs/getting-started/ target=_blank rel="noopener noreferrer">see doc</a>
).</em></p><h3 id=step-2-configuration><a class=heading-anchor href=#step-2-configuration>#</a>Step 2: Configuration</h3><p>To configure, let&rsquo;s first create a configuration file called <code>aiven-kafka-cluster.conf</code> with the following content. You will need to adapt it with your Kafka Service URI.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>jikkou {
</span></span><span style=display:flex><span>    kafka {
</span></span><span style=display:flex><span>        client {
</span></span><span style=display:flex><span>            bootstrap.servers = &#34;&lt;KAFKA_SERVICE_NAME&gt;.aivencloud.com:26896&#34;
</span></span><span style=display:flex><span>            security.protocol = &#34;SSL&#34;
</span></span><span style=display:flex><span>            ssl.keystore.location = &#34;./client.keystore.p12&#34;
</span></span><span style=display:flex><span>            ssl.keystore.password = &#34;&lt;PASSWORD&gt;&#34;
</span></span><span style=display:flex><span>            ssl.keystore.type = &#34;PKCS12&#34;
</span></span><span style=display:flex><span>            ssl.truststore.location = &#34;./client.truststore.jks&#34;
</span></span><span style=display:flex><span>            ssl.truststore.password = &#34;&lt;PASSWORD&gt;&#34;
</span></span><span style=display:flex><span>            ssl.key.password = &#34;&lt;PASSWORD&gt;&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em>Note: Jikkou uses configuration in <a href=https://github.com/lightbend/config/blob/main/HOCON.md target=_blank rel="noopener noreferrer">HOCON</a>
format.</em></p><p>Next, run the following command to create a new context configuration for Jikkou:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6c7086;font-style:italic># Create new context</span>
</span></span><span style=display:flex><span>jikkou config set-context aiven --config-file <span style=color:#a6e3a1>&#34;`pwd`/aiven-kafka-cluster.conf&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic># Use context</span>
</span></span><span style=display:flex><span>jikkou config use-context aiven
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic># View configuration</span>
</span></span><span style=display:flex><span>jikkou config view
</span></span></code></pre></div><p>Finally, to check if you have access to your Apache Kafka, you can use the <code>health</code> command:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>jikkou health get kafkabroker
</span></span></code></pre></div><p>If everything is OK, you get something like:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#fab387>---</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>name</span>: <span style=color:#a6e3a1>&#34;kafka&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>status</span>: <span style=color:#a6e3a1>&#34;UP&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>details</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>resource</span>: <span style=color:#a6e3a1>&#34;urn:kafka:cluster:id:_1h29ptbRbCwNoicDc11WA&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>brokers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#cba6f7>id</span>: <span style=color:#a6e3a1>&#34;1&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#cba6f7>host</span>: <span style=color:#a6e3a1>&#34;**.***.***.196&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#cba6f7>port</span>: <span style=color:#fab387>26896</span>
</span></span><span style=display:flex><span>  - <span style=color:#cba6f7>id</span>: <span style=color:#a6e3a1>&#34;2&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#cba6f7>host</span>: <span style=color:#a6e3a1>&#34;**.***.***.252&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#cba6f7>port</span>: <span style=color:#fab387>26896</span>
</span></span><span style=display:flex><span>  - <span style=color:#cba6f7>id</span>: <span style=color:#a6e3a1>&#34;3&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#cba6f7>host</span>: <span style=color:#a6e3a1>&#34;**.***.***.167&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#cba6f7>port</span>: <span style=color:#fab387>26896</span>
</span></span></code></pre></div><h3 id=step-3--manipulate-kafka-topics-using-jikkou-resources><a class=heading-anchor href=#step-3--manipulate-kafka-topics-using-jikkou-resources>#</a>Step 3 : Manipulate Kafka Topics using Jikkou Resources</h3><p>So, the first thing you can do with Jikkou, is simply to list and describe existing topics. For this, I have intentionally created a topic through the <a href=https://console.aiven.io/ target=_blank rel="noopener noreferrer">Aiven Web Console</a>
:</p><p>Then, via Jikkou we can run the <code>jikkou get &lt;resource-kind></code> command to describe topics:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ jikkou get kafkatopics
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#fab387>---</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>apiVersion</span>: <span style=color:#a6e3a1>&#34;kafka.jikkou.io/v1beta2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>kind</span>: <span style=color:#a6e3a1>&#34;KafkaTopic&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>name</span>: <span style=color:#a6e3a1>&#34;my-first-topic&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>labels</span>: {}
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>kafka.jikkou.io/cluster-id</span>: <span style=color:#a6e3a1>&#34;_1h29ptbRbCwNoicDc11WA&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>jikkou.io/resource-generated</span>: <span style=color:#a6e3a1>&#34;2023-05-16T00:00:00.000000000Z&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>partitions</span>: <span style=color:#fab387>1</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>replicas</span>: <span style=color:#fab387>3</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>configs</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>cleanup.policy</span>: <span style=color:#a6e3a1>&#34;delete&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>min.insync.replicas</span>: <span style=color:#a6e3a1>&#34;2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>configMapRefs</span>: []
</span></span></code></pre></div><p><em>Note: Jikkou adopts the same resource model as Kubernetes to describe entities. Considering that an increasing number of developers are becoming well-familiar with this model, Jikkou attempts to provide developers an intuitive approach to managing Kafka entities.</em></p><p>Next, let&rsquo;s create a new topic by creating a file <code>kafka-topics.yaml</code> with the following content:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#6c7086;font-style:italic># kafka-topics.yaml</span>
</span></span><span style=display:flex><span><span style=color:#fab387>---</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>apiVersion</span>: <span style=color:#a6e3a1>&#34;kafka.jikkou.io/v1beta2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>kind</span>: KafkaTopic
</span></span><span style=display:flex><span><span style=color:#cba6f7>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>name</span>: <span style=color:#a6e3a1>&#39;topic-using-jikkou&#39;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>partitions</span>: <span style=color:#fab387>6</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>replicas</span>: <span style=color:#fab387>3</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>configs</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>min.insync.replicas</span>: <span style=color:#fab387>2</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>cleanup.policy</span>: <span style=color:#a6e3a1>&#39;delete&#39;</span>
</span></span></code></pre></div><p>And, run the <code>jikkou apply -f kafka-topics.yaml</code>, Jikkou should output the executed changes :</p><p><em>(output)</em></p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f38ba8>TASK</span> [<span style=color:#f38ba8>ADD</span>] <span style=color:#f38ba8>Add</span> <span style=color:#f38ba8>topic</span> <span style=color:#f38ba8>&#39;topic-using-jikkou&#39;</span> <span style=color:#f38ba8>(partitions=</span><span style=color:#fab387>6</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>replicas=</span><span style=color:#fab387>3</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>configs=</span>[<span style=color:#f38ba8>cleanup.policy=delete</span>, <span style=color:#f38ba8>min.insync.replicas=</span><span style=color:#fab387>2</span>]<span style=color:#f38ba8>)</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;changed&#34;</span> : <span style=color:#fab387>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;end&#34;</span> : <span style=color:#fab387>1684181768701</span>,
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;resource&#34;</span> : {
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;name&#34;</span> : <span style=color:#a6e3a1>&#34;topic-using-jikkou&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;partitions&#34;</span> : {
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;after&#34;</span> : <span style=color:#fab387>6</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;replicas&#34;</span> : {
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;after&#34;</span> : <span style=color:#fab387>3</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;configs&#34;</span> : {
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;cleanup.policy&#34;</span> : {
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;after&#34;</span> : <span style=color:#a6e3a1>&#34;delete&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;operation&#34;</span> : <span style=color:#a6e3a1>&#34;ADD&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;min.insync.replicas&#34;</span> : {
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;after&#34;</span> : <span style=color:#a6e3a1>&#34;2&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;operation&#34;</span> : <span style=color:#a6e3a1>&#34;ADD&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;operation&#34;</span> : <span style=color:#a6e3a1>&#34;ADD&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;failed&#34;</span> : <span style=color:#fab387>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;status&#34;</span> : <span style=color:#a6e3a1>&#34;CHANGED&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f38ba8>EXECUTION</span> <span style=color:#f38ba8>in</span> <span style=color:#fab387>1</span><span style=color:#f38ba8>s</span> <span style=color:#fab387>627</span><span style=color:#f38ba8>ms</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>ok</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>created</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>1</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>altered</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>deleted</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span> <span style=color:#f38ba8>failed</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span>
</span></span></code></pre></div><p>Then, we could for example add a new property <code>spec.configs.retention.ms: 86400000</code> to our topic and re-run the above command to apply our change:</p><p><em>(output)</em></p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f38ba8>TASK</span> [<span style=color:#f38ba8>UPDATE</span>] <span style=color:#f38ba8>Update</span> <span style=color:#f38ba8>topic</span> <span style=color:#f38ba8>&#39;topic-using-jikkou&#39;</span> <span style=color:#f38ba8>(partitions=</span><span style=color:#fab387>6</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>replicas=</span><span style=color:#fab387>3</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>configs=</span>[<span style=color:#f38ba8>cleanup.policy=delete</span>, <span style=color:#f38ba8>min.insync.replicas=</span><span style=color:#fab387>2</span>, <span style=color:#f38ba8>retention.ms=</span><span style=color:#fab387>86400000</span>]<span style=color:#f38ba8>)</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;changed&#34;</span> : <span style=color:#fab387>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;end&#34;</span> : <span style=color:#fab387>1684182213434</span>,
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;resource&#34;</span> : {
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;name&#34;</span> : <span style=color:#a6e3a1>&#34;topic-using-jikkou&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;partitions&#34;</span> : {
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;after&#34;</span> : <span style=color:#fab387>6</span>,
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;before&#34;</span> : <span style=color:#fab387>6</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;replicas&#34;</span> : {
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;after&#34;</span> : <span style=color:#fab387>3</span>,
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;before&#34;</span> : <span style=color:#fab387>3</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;configs&#34;</span> : {
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;cleanup.policy&#34;</span> : {
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;after&#34;</span> : <span style=color:#a6e3a1>&#34;delete&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;before&#34;</span> : <span style=color:#a6e3a1>&#34;delete&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;operation&#34;</span> : <span style=color:#a6e3a1>&#34;NONE&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;min.insync.replicas&#34;</span> : {
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;after&#34;</span> : <span style=color:#fab387>2</span>,
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;before&#34;</span> : <span style=color:#a6e3a1>&#34;2&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;operation&#34;</span> : <span style=color:#a6e3a1>&#34;NONE&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#cba6f7>&#34;retention.ms&#34;</span> : {
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;after&#34;</span> : <span style=color:#fab387>86400000</span>,
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;before&#34;</span> : <span style=color:#a6e3a1>&#34;604800000&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#cba6f7>&#34;operation&#34;</span> : <span style=color:#a6e3a1>&#34;UPDATE&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;operation&#34;</span> : <span style=color:#a6e3a1>&#34;UPDATE&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;failed&#34;</span> : <span style=color:#fab387>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;status&#34;</span> : <span style=color:#a6e3a1>&#34;CHANGED&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f38ba8>EXECUTION</span> <span style=color:#f38ba8>in</span> <span style=color:#fab387>1</span><span style=color:#f38ba8>s</span> <span style=color:#fab387>734</span><span style=color:#f38ba8>ms</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>ok</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>created</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>altered</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>1</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>deleted</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span> <span style=color:#f38ba8>failed</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span>
</span></span></code></pre></div><p>If we go back to the <a href=https://console.aiven.io/ target=_blank rel="noopener noreferrer">Aiven Web Console</a>
, then we should see our topic with <code>retention.ms</code> set to 24 hours.</p><p>Finally, let&rsquo;s remove our topic by adding using a specific annotation <code>jikkou.io/delete</code> :</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#6c7086;font-style:italic># kafka-topics.yaml</span>
</span></span><span style=display:flex><span><span style=color:#fab387>---</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>apiVersion</span>: <span style=color:#a6e3a1>&#34;kafka.jikkou.io/v1beta2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>kind</span>: KafkaTopic
</span></span><span style=display:flex><span><span style=color:#cba6f7>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>name</span>: <span style=color:#a6e3a1>&#39;topic-using-jikkou&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>jikkou.io/delete</span>: <span style=color:#fab387>true</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>partitions</span>: <span style=color:#fab387>6</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>replicas</span>: <span style=color:#fab387>3</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>configs</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>min.insync.replicas</span>: <span style=color:#fab387>2</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>cleanup.policy</span>: <span style=color:#a6e3a1>&#39;delete&#39;</span>
</span></span></code></pre></div><p>Here, to only execute <code>DELETE</code> change we will use the command <code>jikkou delete --file kafka-topics.yaml</code> (but we could also use <code>apply</code>)</p><p><em>(output)</em></p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f38ba8>TASK</span> [<span style=color:#f38ba8>DELETE</span>] <span style=color:#f38ba8>Delete</span> <span style=color:#f38ba8>topic</span> <span style=color:#f38ba8>&#39;topic-using-jikkou&#39;</span> <span style=color:#f38ba8>(partitions=</span><span style=color:#fab387>null</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>replicas=</span><span style=color:#fab387>null</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>configs=</span>{}<span style=color:#f38ba8>)</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;changed&#34;</span> : <span style=color:#fab387>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;end&#34;</span> : <span style=color:#fab387>1684182658267</span>,
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;resource&#34;</span> : {
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;name&#34;</span> : <span style=color:#a6e3a1>&#34;topic-using-jikkou&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;configs&#34;</span> : { },
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>&#34;operation&#34;</span> : <span style=color:#a6e3a1>&#34;DELETE&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;failed&#34;</span> : <span style=color:#fab387>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&#34;status&#34;</span> : <span style=color:#a6e3a1>&#34;CHANGED&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f38ba8>EXECUTION</span> <span style=color:#f38ba8>in</span> <span style=color:#fab387>1</span><span style=color:#f38ba8>s</span> <span style=color:#fab387>976</span><span style=color:#f38ba8>ms</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>ok</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>created</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>altered</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span><span style=color:#f38ba8>,</span> <span style=color:#f38ba8>deleted</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>1</span> <span style=color:#f38ba8>failed</span> <span style=color:#f38ba8>:</span> <span style=color:#fab387>0</span>
</span></span></code></pre></div><h3 id=step-4--using-template><a class=heading-anchor href=#step-4--using-template>#</a>Step 4 : Using Template</h3><p>Sometimes, defining Kafka topics one by one can be tedious, especially when the topics you need to create follow a similar pattern. For solving this, Jikkou provides a simple templating mechanism based on <a href=https://github.com/HubSpot/jinjava target=_blank rel="noopener noreferrer">Jinjava</a>
, a <a href=https://jinja.palletsprojects.com/ target=_blank rel="noopener noreferrer">Jinja</a>
template engine for Java.</p><p>Let&rsquo;s imagine a scenario where we need to collect IoT sensor data and organize it into Kafka topics based on a combination of country code (used as a suffix) and an environment name (used as a prefix). For doing this, we can start by creating a YAML file that contains all the necessary values to be used in our template.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#6c7086;font-style:italic># file: ./values.yaml</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>topicConfigs</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>partitions</span>: <span style=color:#fab387>4</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>replicas</span>: <span style=color:#fab387>3</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>topicPrefix</span>: <span style=color:#a6e3a1>&#34;{{ system.env.TOPIC_PREFIX | default(&#39;test&#39;, true) }}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>countryCodes</span>:
</span></span><span style=display:flex><span>  - fr
</span></span><span style=display:flex><span>  - be
</span></span><span style=display:flex><span>  - de
</span></span><span style=display:flex><span>  - es
</span></span><span style=display:flex><span>  - uk
</span></span><span style=display:flex><span>  - us
</span></span></code></pre></div><p>Next, we can create our template as follows:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#6c7086;font-style:italic># file: ./kafka-topics.tpl</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>apiVersion</span>: <span style=color:#a6e3a1>&#39;kafka.jikkou.io/v1beta2&#39;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>kind</span>: <span style=color:#a6e3a1>&#39;KafkaTopicList&#39;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>items</span>:
</span></span><span style=display:flex><span>{% for country in values.countryCodes %}
</span></span><span style=display:flex><span>- <span style=color:#cba6f7>metadata</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>name</span>: <span style=color:#a6e3a1>&#34;{{ values.topicPrefix}}-iot-events-{{ country }}&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>spec</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>partitions</span>: {{ values.topicConfigs.partitions }}
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>replicas</span>: {{ values.topicConfigs.replicas }}
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>configMapRefs</span>:
</span></span><span style=display:flex><span>      - TopicConfig
</span></span><span style=display:flex><span>{% endfor %}
</span></span><span style=display:flex><span><span style=color:#fab387>---</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>apiVersion</span>: <span style=color:#a6e3a1>&#34;core.jikkou.io/v1beta2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>kind</span>: <span style=color:#a6e3a1>&#34;ConfigMap&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>name</span>: TopicConfig
</span></span><span style=display:flex><span><span style=color:#cba6f7>template</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>values</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>default_min_insync_replicas</span>: <span style=color:#a6e3a1>&#34;{{ values.topicConfigs.replicas | default(3, true) }}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>retention.ms</span>: <span style=color:#fab387>3600000</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>max.message.bytes</span>: <span style=color:#fab387>20971520</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>min.insync.replicas</span>: <span style=color:#a6e3a1>&#39;{% raw %}{{ values.default_min_insync_replicas }}{% endraw %}&#39;</span>
</span></span></code></pre></div><p>You might have noticed that in the template above, we intentionally introduced two new resource types: <code>KafkaTopicList</code> and <code>ConfigMap</code>.</p><ul><li><p><code>KafkaTopicList</code> : This resource type allows you to define a collection of topic objects that may share, for example, some labels and or annotations. Using a <code>KafkaTopicList</code> can be useful if, for example, we need to delete all resources by adding a single annotation as seen previously.</p></li><li><p><code>ConfigMap</code> : This resource type allows you to define reusable data in the form of key/value pairs that can then be referenced by other resources, within the Jikkou configuration, promoting modularity and reducing duplication.</p></li></ul><p>Next, to validate our template before running it we can use the <code>validate</code> command.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f5e0dc>TOPIC_PREFIX</span><span style=color:#89dceb;font-weight:700>=</span>demo jikkou validate --files ./kafka-topics.tpl --values-files values.yaml
</span></span></code></pre></div><p>Finally, create all topics with the <code>apply</code> command. Then, going back to the <a href=https://console.aiven.io/ target=_blank rel="noopener noreferrer">Aiven Web Console</a>
, all our topics should be created.</p><h3 id=step-4--validation><a class=heading-anchor href=#step-4--validation>#</a>Step 4 : Validation</h3><p>Another significant feature of Jikkou is the ability to configure <a href=https://streamthoughts.github.io/jikkou/docs/validation/ target=_blank rel="noopener noreferrer">validation</a>
rules that are applied to all resources before their deployment.</p><p>To illustrate this, let&rsquo;s revisit our previous example. Imagine that we only want to allow the creation of Kafka topics with a prefix corresponding to a specific region, such as &ldquo;europe&rdquo;, &ldquo;northamerica&rdquo;, or &ldquo;asiapacific&rdquo;. For doing so, we can edit the configuration of our client (<code>aiven-kafka-cluster.conf</code>) to use the built-in <code>TopicNameRegexValidation</code> as follows:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>jikkou {
</span></span><span style=display:flex><span>    # ...ommitted for clarity
</span></span><span style=display:flex><span>    validations: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            # Custom name for the validation rule
</span></span><span style=display:flex><span>            name = topicMustHaveRegionPrefix
</span></span><span style=display:flex><span>            # The name or fully-qualified name of the Validation class , e.g.:
</span></span><span style=display:flex><span>            type = TopicNameRegexValidation
</span></span><span style=display:flex><span>            # The config values that will be passed to the validation.
</span></span><span style=display:flex><span>            config = {
</span></span><span style=display:flex><span>                topicNameRegex = &#34;(europe|northamerica|asiapacific)-.+&#34;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now, we attempt to create topics using the previous command :</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f5e0dc>TOPIC_PREFIX</span><span style=color:#89dceb;font-weight:700>=</span>demo jikkou apply --files ./kafka-topics.tpl --values-files values.yaml
</span></span></code></pre></div><p>Jikkou will prompt all the errors:</p><p><em>(output)</em></p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Error: io.streamthoughts.jikkou.api.error.ValidationException:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- topicMustHaveRegionPrefix: Name for topic &#39;demo-iot-events-fr&#39; does not match the configured regex &#39;(europe|northamerica|asiapacific)-.+&#39;
</span></span><span style=display:flex><span>- topicMustHaveRegionPrefix: Name for topic &#39;demo-iot-events-be&#39; does not match the configured regex &#39;(europe|northamerica|asiapacific)-.+&#39;
</span></span><span style=display:flex><span>- topicMustHaveRegionPrefix: Name for topic &#39;demo-iot-events-de&#39; does not match the configured regex &#39;(europe|northamerica|asiapacific)-.+&#39;
</span></span><span style=display:flex><span>- topicMustHaveRegionPrefix: Name for topic &#39;demo-iot-events-es&#39; does not match the configured regex &#39;(europe|northamerica|asiapacific)-.+&#39;
</span></span><span style=display:flex><span>- topicMustHaveRegionPrefix: Name for topic &#39;demo-iot-events-uk&#39; does not match the configured regex &#39;(europe|northamerica|asiapacific)-.+&#39;
</span></span><span style=display:flex><span>- topicMustHaveRegionPrefix: Name for topic &#39;demo-iot-events-us&#39; does not match the configured regex &#39;(europe|northamerica|asiapacific)-.+&#39;
</span></span></code></pre></div><h3 id=step-5--transformation><a class=heading-anchor href=#step-5--transformation>#</a>Step 5 : Transformation</h3><p>Last but no least, Jikkou provides a mechanism of <em>Transformations</em> that can be used to filter, and transform resources before being validated. To illustrate this concept, let&rsquo;s reuse our previous example and configure a <em>transformation chain</em> so that we will enforce some configuration on our topics.</p><p>For doing so, we can edit the configuration of our client (<code>aiven-kafka-cluster.conf</code>) as follows:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>jikkou {
</span></span><span style=display:flex><span>    # ...ommitted for clarity
</span></span><span style=display:flex><span>    transformations: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            # Enforce a minimum &#39;retention.ms&#39;
</span></span><span style=display:flex><span>            type = KafkaTopicMinRetentionMsTransformation
</span></span><span style=display:flex><span>            priority = 100
</span></span><span style=display:flex><span>            config = {
</span></span><span style=display:flex><span>                minRetentionMs = 259200000
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            # Enforce a minimum &#39;number of replicas&#39;
</span></span><span style=display:flex><span>            type = KafkaTopicMinReplicasTransformation
</span></span><span style=display:flex><span>            priority = 100
</span></span><span style=display:flex><span>            config = {
</span></span><span style=display:flex><span>                minReplicationFactor = 3
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            # Enforce &#39;min.insync.replicas&#39;
</span></span><span style=display:flex><span>            type = KafkaTopicMinInSyncReplicasTransformation
</span></span><span style=display:flex><span>            priority = 100
</span></span><span style=display:flex><span>            config = {
</span></span><span style=display:flex><span>                minInSyncReplicas = 2
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Next, let&rsquo;s execute the <code>jikkou validate</code> command to observe the changes:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f5e0dc>TOPIC_PREFIX</span><span style=color:#89dceb;font-weight:700>=</span>europe jikkou validate --files ./kafka-topics.tpl --values-files values.yaml
</span></span></code></pre></div><p><em>(Output)</em></p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#fab387>---</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>apiVersion</span>: <span style=color:#a6e3a1>&#34;kafka.jikkou.io/v1beta2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>kind</span>: <span style=color:#a6e3a1>&#34;KafkaTopic&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>name</span>: <span style=color:#a6e3a1>&#34;europe-iot-events-us&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>labels</span>: {}
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>transform.jikkou.io/kafka-min-retention-ms</span>: <span style=color:#fab387>259200000</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>partitions</span>: <span style=color:#fab387>4</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>replicas</span>: <span style=color:#fab387>3</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>configs</span>:
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>max.message.bytes</span>: <span style=color:#fab387>20971520</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>min.insync.replicas</span>: <span style=color:#a6e3a1>&#34;2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>retention.ms</span>: <span style=color:#fab387>259200000</span>
</span></span></code></pre></div><p>In the example above, only the <code>KafkaTopicRetentionMsTransformation</code> has been applied as other configurations already conform to the rules we have defined (<code>retention.ms</code> = 3600000 -> 20971520).</p><p>Finally, the transformation adds the annotation <code>transform.jikkou.io/kafka-min-retention-ms</code> to indicate the modification.</p><h2 id=and-what-about-the-jikkou-api-><a class=heading-anchor href=#and-what-about-the-jikkou-api->#</a>And, what about the Jikkou API ?</h2><p>Basically, all the operations we have seen so far can be executed programmatically. Although it would take too long to explore the full Jikkou API in this article, here is a simple example that demonstrates how to create Kafka topics using a resource description file.</p><p>First, create a Java project, for example, using Maven. Then, add the following dependency to the <code>pom.xml</code> file of your project:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#cba6f7>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&lt;groupId&gt;</span>io.streamthoughts<span style=color:#cba6f7>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&lt;artifactId&gt;</span>jikkou-extension-kafka<span style=color:#cba6f7>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>&lt;version&gt;</span>0.19.0<span style=color:#cba6f7>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>After adding the dependency, create a simple class with a static <code>main</code> method as shown below:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f38ba8>public</span> <span style=color:#f38ba8>class</span> <span style=color:#f9e2af>CreateKafkaTopicsExample</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>public</span> <span style=color:#f38ba8>static</span> <span style=color:#f38ba8>void</span> <span style=color:#89b4fa>main</span>(String<span style=color:#89dceb;font-weight:700>[]</span> args) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6c7086;font-style:italic>// (1) Register Kinds</span>
</span></span><span style=display:flex><span>        ResourceDeserializer.<span style=color:#89b4fa>registerKind</span>(V1KafkaTopic.<span style=color:#89b4fa>class</span>);
</span></span><span style=display:flex><span>        ResourceDeserializer.<span style=color:#89b4fa>registerKind</span>(V1KafkaTopicList.<span style=color:#89b4fa>class</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6c7086;font-style:italic>// (2) Load Resources</span>
</span></span><span style=display:flex><span>        HasItems resources <span style=color:#89dceb;font-weight:700>=</span> ResourceLoader.<span style=color:#89b4fa>create</span>().<span style=color:#89b4fa>load</span>(List.<span style=color:#89b4fa>of</span>(<span style=color:#a6e3a1>&#34;./kafka-topics.yaml&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6c7086;font-style:italic>// (3) Create and configure Jikkou API</span>
</span></span><span style=display:flex><span>        AdminClientContext clientContext <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#cba6f7>new</span> AdminClientContext(
</span></span><span style=display:flex><span>                () <span style=color:#89dceb;font-weight:700>-&gt;</span> AdminClient.<span style=color:#89b4fa>create</span>(Map.<span style=color:#89b4fa>of</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e3a1>&#34;bootstrap.servers&#34;</span>, <span style=color:#a6e3a1>&#34;&lt;KAFKA_SERVICE_NAME&gt;.aivencloud.com:26896&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e3a1>&#34;security.protocol&#34;</span>, <span style=color:#a6e3a1>&#34;SSL&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e3a1>&#34;ssl.keystore.location&#34;</span>, <span style=color:#a6e3a1>&#34;./client.keystore.p12&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e3a1>&#34;ssl.keystore.password&#34;</span>, <span style=color:#a6e3a1>&#34;&lt;PASSWORD&gt;&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e3a1>&#34;ssl.keystore.type&#34;</span>, <span style=color:#a6e3a1>&#34;PKCS12&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e3a1>&#34;ssl.truststore.location&#34;</span>, <span style=color:#a6e3a1>&#34;./client.truststore.jks&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e3a1>&#34;ssl.truststore.password&#34;</span>, <span style=color:#a6e3a1>&#34;&lt;PASSWORD&gt;&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e3a1>&#34;ssl.key.password&#34;</span>, <span style=color:#a6e3a1>&#34;&lt;PASSWORD&gt;&#34;</span>
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>try</span> (JikkouApi api <span style=color:#89dceb;font-weight:700>=</span> DefaultApi.<span style=color:#89b4fa>builder</span>()
</span></span><span style=display:flex><span>                <span style=color:#6c7086;font-style:italic>// Collectors are used to list all resources entities from system</span>
</span></span><span style=display:flex><span>                .<span style=color:#89b4fa>withCollector</span>(<span style=color:#cba6f7>new</span> AdminClientKafkaTopicCollector(clientContext))
</span></span><span style=display:flex><span>                <span style=color:#6c7086;font-style:italic>// Controllers are responsible for computing and applying changes</span>
</span></span><span style=display:flex><span>                .<span style=color:#89b4fa>withController</span>(<span style=color:#cba6f7>new</span> AdminClientKafkaTopicController(clientContext))
</span></span><span style=display:flex><span>                .<span style=color:#89b4fa>build</span>()) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#6c7086;font-style:italic>// (4) Execute Reconciliation</span>
</span></span><span style=display:flex><span>            List<span style=color:#89dceb;font-weight:700>&lt;</span>ChangeResult<span style=color:#89dceb;font-weight:700>&lt;</span>Change<span style=color:#89dceb;font-weight:700>&gt;&gt;</span> changes <span style=color:#89dceb;font-weight:700>=</span> api.<span style=color:#89b4fa>apply</span>(
</span></span><span style=display:flex><span>                    resources,
</span></span><span style=display:flex><span>                    ReconciliationMode.<span style=color:#89b4fa>CREATE</span>,
</span></span><span style=display:flex><span>                    ReconciliationContext.<span style=color:#89b4fa>with</span>(<span style=color:#fab387>false</span>) <span style=color:#6c7086;font-style:italic>// dry-run=false</span>
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#6c7086;font-style:italic>// (5) Do something with changes</span>
</span></span><span style=display:flex><span>            System.<span style=color:#89b4fa>out</span>.<span style=color:#89b4fa>println</span>(changes);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=whats-next-><a class=heading-anchor href=#whats-next->#</a>What&rsquo;s Next ?</h2><p>When I started developing Jikkou (formerly known as Kafka Specs), it was just a Java CLI implemented on a corner of the couch (and probably while watching a Netflix series). Initially, I used it during consulting and audit missions to quickly export configurations from Kafka clusters. Now, Jikkou is used in production on several projects, providing efficient Kafka topic management through a GitOps approach.</p><p>Jikkou is not extraordinary in itself, but I hope it will help some teams of developers. Its simplicity and flexibility are designed to address common pain points in Kafka that I still find very often on new projects.</p><p>In the near future, I have exciting plans to enhance Jikkou further. One of our key focuses will be adding support for additional resources, such as managing schemas in Schema Registry. This new features will enable you to seamlessly handle more aspects of your Kafka ecosystem using Jikkou&rsquo;s intuitive interface.</p><p>If you find this project valuable, I kindly ask you to show your support by sharing this article and spreading the word. You can even show your support by giving a star on the <a href=https://github.com/streamthoughts/jikkou target=_blank rel="noopener noreferrer">GitHub</a>
repository.</p><p>We also welcome contributions from the community. If you have any ideas or specific project needs, please feel free to reach out and propose them. You can actively contribute to the project by creating <a href=https://github.com/streamthoughts/jikkou/pulls target=_blank rel="noopener noreferrer">pull requests</a>
(PR).</p><p><strong>Thank you very much.</strong></p></div><nav class=post-nav><span></span>
<a class=next href=https://www.fhussonnois.dev/posts/2024-06-04-orchestration/>Navigating Complexity: The Rise of Orchestration Platforms in a Disaggregated Software Architecture Landscape</a></nav></article></main><footer class=site-footer><div class=container><div class=footer-socials><a href=https://github.com/fhussonnois target=_blank rel=noopener aria-label=GitHub><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/fhussonnois target=_blank rel=noopener aria-label=Twitter><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1.0 3-1.2 3-1.2z"/></svg></a><a href=https://www.linkedin.com/in/florian-hussonnois/ target=_blank rel=noopener aria-label=LinkedIn><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://stackoverflow.com/users/3660859/fhussonnois target=_blank rel=noopener aria-label="Stack Overflow"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 20h16"/><path d="M4 20V12"/><path d="M20 20V12"/><path d="M7 17h10"/><path d="M7.5 13.5l9.2 1.8"/><path d="M8.8 10.1l8.5 3.9"/><path d="M11 7l7.1 5.8"/></svg></a></div><p class=footer-prompt><span class=prompt>>_</span> &copy; 2026 Florian Hussonnois</p></div></footer><script src=/js/theme-toggle.min.8c15e1b03ddad9066a2d55e38fe897951bafbc6b24db02de0ea1d219296def11.js></script></body></html>